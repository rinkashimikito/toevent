---
phase: 07-distribution-notarization
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - ToEvent/ToEvent/Views/WhatsNewView.swift
  - ToEvent/ToEvent/Utilities/WhatsNewCheck.swift
  - ToEvent/ToEvent/ToEventApp.swift
  - CHANGELOG.md
autonomous: true

must_haves:
  truths:
    - "User sees changelog on first launch of new version"
    - "Changelog does not appear on subsequent launches of same version"
    - "User can dismiss changelog and continue using app"
  artifacts:
    - path: "ToEvent/ToEvent/Views/WhatsNewView.swift"
      provides: "Changelog display view"
      exports: ["WhatsNewView"]
    - path: "ToEvent/ToEvent/Utilities/WhatsNewCheck.swift"
      provides: "Version comparison logic"
      exports: ["WhatsNewCheck"]
    - path: "CHANGELOG.md"
      provides: "Version history"
      contains: "0.9.0"
  key_links:
    - from: "ToEventApp.swift"
      to: "WhatsNewCheck"
      via: "shouldShowWhatsNew check"
      pattern: "WhatsNewCheck\\.shouldShow"
    - from: "ToEventApp.swift"
      to: "WhatsNewView"
      via: "Sheet presentation"
      pattern: "WhatsNewView"
---

<objective>
Add What's New screen shown on first launch after update

Purpose: Inform users about new features and changes when they update the app
Output: Changelog view that appears once per version, plus CHANGELOG.md file
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-distribution-notarization/07-RESEARCH.md

@ToEvent/ToEvent/ToEventApp.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WhatsNewCheck utility and WhatsNewView</name>
  <files>
    ToEvent/ToEvent/Utilities/WhatsNewCheck.swift
    ToEvent/ToEvent/Views/WhatsNewView.swift
  </files>
  <action>
    1. Create WhatsNewCheck.swift in Utilities:
       ```swift
       import Foundation

       struct WhatsNewCheck {
           private static let lastVersionKey = "lastSeenVersion"

           static func shouldShowWhatsNew() -> Bool {
               let currentVersion = Bundle.main.object(forInfoDictionaryKey: "CFBundleShortVersionString") as? String ?? "0"
               let lastVersion = UserDefaults.standard.string(forKey: lastVersionKey)

               // Show if first launch or version changed
               if lastVersion == nil {
                   // First launch - mark as seen without showing
                   markAsSeen()
                   return false
               }
               return lastVersion != currentVersion
           }

           static func markAsSeen() {
               let currentVersion = Bundle.main.object(forInfoDictionaryKey: "CFBundleShortVersionString") as? String ?? "0"
               UserDefaults.standard.set(currentVersion, forKey: lastVersionKey)
           }

           static var currentVersion: String {
               Bundle.main.object(forInfoDictionaryKey: "CFBundleShortVersionString") as? String ?? "0.0.0"
           }
       }
       ```

       Note: First launch skips What's New (no previous version to compare). Shows only on UPDATE from previous version.

    2. Create WhatsNewView.swift in Views:
       ```swift
       import SwiftUI

       struct WhatsNewView: View {
           @Environment(\.dismiss) private var dismiss

           var body: some View {
               VStack(spacing: 20) {
                   Text("What's New in ToEvent")
                       .font(.title2)
                       .fontWeight(.semibold)

                   Text("Version \(WhatsNewCheck.currentVersion)")
                       .font(.subheadline)
                       .foregroundStyle(.secondary)

                   ScrollView {
                       VStack(alignment: .leading, spacing: 16) {
                           ChangelogSection(
                               title: "Initial Release",
                               items: [
                                   "Live countdown timer in menu bar",
                                   "Color-coded urgency warnings",
                                   "Google Calendar and Outlook integration",
                                   "One-click meeting join",
                                   "Event notifications with snooze",
                                   "Focus mode filtering",
                                   "Quick-add events"
                               ]
                           )
                       }
                       .padding()
                   }
                   .frame(maxHeight: 300)

                   Button("Continue") {
                       WhatsNewCheck.markAsSeen()
                       dismiss()
                   }
                   .buttonStyle(.borderedProminent)
               }
               .padding(24)
               .frame(width: 400)
           }
       }

       struct ChangelogSection: View {
           let title: String
           let items: [String]

           var body: some View {
               VStack(alignment: .leading, spacing: 8) {
                   Text(title)
                       .font(.headline)

                   ForEach(items, id: \.self) { item in
                       HStack(alignment: .top, spacing: 8) {
                           Image(systemName: "checkmark.circle.fill")
                               .foregroundStyle(.green)
                               .font(.caption)
                           Text(item)
                               .font(.body)
                       }
                   }
               }
           }
       }
       ```

       Keep content hardcoded for now - simpler than parsing CHANGELOG.md. Update manually per release.
  </action>
  <verify>
    - WhatsNewCheck.swift compiles
    - WhatsNewView.swift compiles
    - Build succeeds: `xcodebuild -project ToEvent/ToEvent.xcodeproj -scheme ToEvent build`
  </verify>
  <done>
    WhatsNewCheck utility tracks version, WhatsNewView displays changelog with Continue button
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate What's New with app and create CHANGELOG</name>
  <files>
    ToEvent/ToEvent/ToEventApp.swift
    CHANGELOG.md
  </files>
  <action>
    1. Update ToEventApp.swift:
       - Add @State for showWhatsNew: Bool
       - In init() or onAppear, check WhatsNewCheck.shouldShowWhatsNew()
       - Present WhatsNewView as sheet from MenuBarExtra window

       ```swift
       @State private var showWhatsNew = false

       // In body, add to MenuBarExtra content:
       .onAppear {
           if WhatsNewCheck.shouldShowWhatsNew() {
               showWhatsNew = true
           }
       }
       .sheet(isPresented: $showWhatsNew) {
           WhatsNewView()
       }
       ```

       Note: Sheet from MenuBarExtra may need Window scene fallback. Test and adjust.

    2. Create CHANGELOG.md at repository root:
       ```markdown
       # Changelog

       All notable changes to ToEvent will be documented in this file.

       The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
       and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

       ## [0.9.0] - 2026-01-25

       ### Added
       - Live countdown timer in menu bar with color-coded urgency
       - Calendar integration: Local (EventKit), Google Calendar, Outlook
       - Dropdown event list with upcoming events
       - One-click meeting join (Zoom, Meet, Teams, WebEx)
       - Event notifications with snooze options (3, 5, 10 minutes)
       - Customizable urgency thresholds
       - Time display formats (countdown, absolute, both)
       - Privacy mode to hide event titles
       - Natural language time display option
       - Focus mode to filter events by context
       - Quick-add event via Calendar app
       - Global keyboard shortcut for dropdown
       - Auto-launch at login
       - Sparkle auto-updates

       ### Notes
       - First public beta release
       - Requires macOS 13.0 (Ventura) or later
       - GPL-3.0 licensed
       ```

       CHANGELOG.md serves as historical record. WhatsNewView content is maintained separately (simpler).
  </action>
  <verify>
    - App builds: `xcodebuild -project ToEvent/ToEvent.xcodeproj -scheme ToEvent build`
    - CHANGELOG.md exists with 0.9.0 entry
    - Launch app, verify no What's New on first run (expected - first launch skips)
    - Manually test: Clear UserDefaults key, set old version, relaunch to trigger What's New
  </verify>
  <done>
    What's New screen integrated, shows on first launch of new version, CHANGELOG.md documents version history
  </done>
</task>

</tasks>

<verification>
- [ ] WhatsNewCheck correctly identifies version changes
- [ ] WhatsNewView displays with changelog items
- [ ] Continue button dismisses and marks version seen
- [ ] App doesn't show What's New on fresh install (first launch)
- [ ] App shows What's New when upgrading from previous version
- [ ] CHANGELOG.md has 0.9.0 release notes
</verification>

<success_criteria>
Users see What's New dialog on first launch after updating. Dialog shows key changes and dismisses cleanly. CHANGELOG.md provides version history for releases.
</success_criteria>

<output>
After completion, create `.planning/phases/07-distribution-notarization/07-03-SUMMARY.md`
</output>
