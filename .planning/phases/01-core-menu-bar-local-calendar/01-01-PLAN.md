---
phase: 01-core-menu-bar-local-calendar
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ToEvent/ToEvent.xcodeproj
  - ToEvent/ToEventApp.swift
  - ToEvent/Info.plist
  - ToEvent/Services/CalendarService.swift
  - ToEvent/Models/Event.swift
  - ToEvent/Models/CalendarInfo.swift
autonomous: true

must_haves:
  truths:
    - "Xcode project builds without errors"
    - "MenuBarExtra appears in menu bar when app runs"
    - "CalendarService can request calendar permission"
    - "CalendarService can fetch events from EventKit"
  artifacts:
    - path: "ToEvent/ToEventApp.swift"
      provides: "App entry point with MenuBarExtra scene"
      contains: "MenuBarExtra"
    - path: "ToEvent/Services/CalendarService.swift"
      provides: "Singleton EventKit wrapper"
      contains: "EKEventStore"
    - path: "ToEvent/Models/Event.swift"
      provides: "Domain event model"
      exports: ["Event"]
    - path: "ToEvent/Info.plist"
      provides: "App configuration with calendar entitlements"
      contains: "NSCalendarsFullAccessUsageDescription"
  key_links:
    - from: "ToEventApp.swift"
      to: "MenuBarExtra"
      via: "SwiftUI Scene"
      pattern: "MenuBarExtra.*menuBarExtraStyle.*window"
    - from: "CalendarService.swift"
      to: "EKEventStore"
      via: "singleton pattern"
      pattern: "static let shared"
---

<objective>
Create the Xcode project foundation with MenuBarExtra shell and CalendarService for EventKit integration.

Purpose: Establishes the app structure and data layer that all subsequent plans build upon.
Output: Building Xcode project with menu bar presence and functional calendar data access.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-core-menu-bar-local-calendar/01-RESEARCH.md
@.planning/phases/01-core-menu-bar-local-calendar/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Xcode project with MenuBarExtra</name>
  <files>
    ToEvent/ToEvent.xcodeproj
    ToEvent/ToEventApp.swift
    ToEvent/Info.plist
  </files>
  <action>
Create a new macOS App project named "ToEvent" using SwiftUI.

Configure Info.plist:
- Set LSUIElement = YES (Application is agent, no dock icon)
- Add NSCalendarsFullAccessUsageDescription: "ToEvent needs calendar access to show your upcoming events in the menu bar."
- Add NSCalendarsUsageDescription (for macOS 13 compat): same message
- Set minimum deployment target to macOS 13.0

Create ToEventApp.swift with:
- MenuBarExtra scene using `.menuBarExtraStyle(.window)` (critical: .menu style breaks timers)
- Label with calendar system image and "ToEvent" text
- Placeholder view that shows "Loading..." text
- Frame constraint on the window (width: 280, height: 60)

Do NOT add Settings scene yet (Plan 03).
Do NOT add AppDelegate unless absolutely required.
  </action>
  <verify>
Run `xcodebuild -project ToEvent/ToEvent.xcodeproj -scheme ToEvent build` - should complete without errors.
Launch app - menu bar icon should appear.
  </verify>
  <done>
Xcode project builds successfully. Menu bar item visible with placeholder content. No dock icon appears.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement CalendarService and Event model</name>
  <files>
    ToEvent/Services/CalendarService.swift
    ToEvent/Models/Event.swift
    ToEvent/Models/CalendarInfo.swift
  </files>
  <action>
Create Event.swift model:
- Struct with: id (String), title (String), startDate (Date), endDate (Date), isAllDay (Bool), calendarColor (CGColor), calendarID (String)
- Init from EKEvent convenience initializer
- Identifiable conformance

Create CalendarInfo.swift model:
- Struct with: id (String), title (String), color (CGColor), source (String for account name)
- Init from EKCalendar convenience initializer
- Identifiable conformance

Create CalendarService.swift:
- Singleton pattern: `static let shared = CalendarService()`
- Private `let store = EKEventStore()`
- Subscribe to EKEventStoreChangedNotification in init using NotificationCenter.default.publisher + Combine sink
- Method: `func authorizationStatus() -> EKAuthorizationStatus`
- Method: `func requestAccess() async -> Bool` - use requestFullAccessToEvents() on macOS 14+, fall back to requestAccess(to:) on macOS 13
- Method: `func fetchUpcomingEvents(from calendars: [String]?, lookahead: TimeInterval) -> [Event]` - returns sorted by startDate, nil calendars means all
- Method: `func getCalendars() -> [CalendarInfo]`
- Published property: `@Published var lastRefresh = Date()` - updated when EKEventStoreChangedNotification fires

Use @available checks for macOS 14 vs 13 API differences.
  </action>
  <verify>
Build project - no compiler errors.
Unit test or playground: CalendarService.shared.getCalendars() returns array (may be empty without permission, but no crash).
  </verify>
  <done>
CalendarService compiles and is callable. EKEventStore initialized as singleton. Permission request method available. Event fetching method available.
  </done>
</task>

</tasks>

<verification>
1. `xcodebuild -project ToEvent/ToEvent.xcodeproj -scheme ToEvent build` succeeds
2. App launches and shows menu bar item (no dock icon)
3. CalendarService.shared accessible from app
4. Project structure matches recommended layout from RESEARCH.md
</verification>

<success_criteria>
- Xcode project builds without errors or warnings
- Menu bar extra appears when app runs
- CalendarService singleton initialized
- Event and CalendarInfo models defined
- Info.plist has calendar permission descriptions
- No dock icon (LSUIElement = YES)
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-menu-bar-local-calendar/01-01-SUMMARY.md`
</output>
