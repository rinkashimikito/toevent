---
phase: 06-meeting-links-notifications
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - ToEvent/ToEvent/Views/EventRowView.swift
  - ToEvent/ToEvent/Views/EventDetailView.swift
  - ToEvent/ToEvent/Extensions/Event+Actions.swift
autonomous: true

must_haves:
  truths:
    - "User can click Join button to open meeting URL in browser"
    - "User can click Directions button to open Maps with location"
    - "User can copy event details to clipboard"
    - "Actions only appear when relevant (Join when URL exists, Directions when location exists)"
  artifacts:
    - path: "ToEvent/ToEvent/Extensions/Event+Actions.swift"
      provides: "Action computed properties and methods"
      exports: ["canJoinMeeting", "canGetDirections", "openMeetingURL", "openInMaps", "copyToClipboard"]
    - path: "ToEvent/ToEvent/Views/EventDetailView.swift"
      provides: "Full event detail popup with action buttons"
      min_lines: 60
  key_links:
    - from: "EventDetailView.swift"
      to: "Event+Actions.swift"
      via: "calls event.openMeetingURL(), event.openInMaps()"
      pattern: "event\\.open"
    - from: "EventRowView.swift"
      to: "EventDetailView.swift"
      via: "shows detail on tap or shows quick actions"
---

<objective>
Add event action buttons: Join Meeting, Get Directions, Copy Details. Create Event extension with action methods and EventDetailView for full event display.

Purpose: Enables one-click meeting join (ACTN-01), directions (ACTN-02), and copy (ACTN-03).
Output: Event+Actions extension, EventDetailView, enhanced EventRowView
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-meeting-links-notifications/06-RESEARCH.md
@.planning/phases/06-meeting-links-notifications/06-01-SUMMARY.md
@ToEvent/ToEvent/Models/Event.swift
@ToEvent/ToEvent/Views/EventRowView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Event+Actions extension</name>
  <files>ToEvent/ToEvent/Extensions/Event+Actions.swift</files>
  <action>
Create new file with Event extension for action capabilities:

```swift
import AppKit
import MapKit

extension Event {
    // MARK: - Computed Properties

    /// Whether event has a meeting URL that can be opened
    var canJoinMeeting: Bool {
        meetingURL != nil
    }

    /// Whether event has a location for directions
    var canGetDirections: Bool {
        guard let location = location, !location.isEmpty else { return false }
        return true
    }

    // MARK: - Actions

    /// Open meeting URL in default browser
    func openMeetingURL() {
        guard let url = meetingURL else { return }
        NSWorkspace.shared.open(url)
    }

    /// Open Maps with directions to event location
    func openInMaps() {
        guard let location = location, !location.isEmpty else { return }

        // Use maps URL scheme with destination address
        let encodedAddress = location.addingPercentEncoding(
            withAllowedCharacters: .urlQueryAllowed
        ) ?? location

        // Use Apple Maps URL scheme for directions
        if let url = URL(string: "maps://?daddr=\(encodedAddress)") {
            NSWorkspace.shared.open(url)
        }
    }

    /// Copy event details to clipboard
    func copyToClipboard() {
        var details = title

        // Add time
        let formatter = DateFormatter()
        formatter.dateStyle = .medium
        formatter.timeStyle = .short

        if isAllDay {
            formatter.timeStyle = .none
            details += "\n\(formatter.string(from: startDate)) (All day)"
        } else {
            details += "\n\(formatter.string(from: startDate))"
        }

        // Add location if present
        if let location = location, !location.isEmpty {
            details += "\nLocation: \(location)"
        }

        // Add meeting URL if present
        if let meetingURL = meetingURL {
            details += "\nMeeting: \(meetingURL.absoluteString)"
        }

        // Add notes excerpt if present
        if let notes = notes, !notes.isEmpty {
            let excerpt = notes.prefix(200)
            details += "\n\n\(excerpt)\(notes.count > 200 ? "..." : "")"
        }

        NSPasteboard.general.clearContents()
        NSPasteboard.general.setString(details, forType: .string)
    }

    /// Open event in Calendar app (existing functionality, move here)
    func openInCalendar() {
        // Only works for local events
        guard source == .local else { return }

        let script = """
        tell application "Calendar"
            activate
            view calendar at date "\(formattedDateForAppleScript)"
        end tell
        """

        if let appleScript = NSAppleScript(source: script) {
            var error: NSDictionary?
            appleScript.executeAndReturnError(&error)
        }
    }

    private var formattedDateForAppleScript: String {
        let formatter = DateFormatter()
        formatter.dateFormat = "EEEE, MMMM d, yyyy"
        return formatter.string(from: startDate)
    }
}
```

Add file to Xcode project in Extensions group. Create the group if it doesn't exist.
  </action>
  <verify>Build succeeds with Event+Actions extension</verify>
  <done>Event has canJoinMeeting, canGetDirections computed properties and action methods</done>
</task>

<task type="auto">
  <name>Task 2: Create EventDetailView</name>
  <files>ToEvent/ToEvent/Views/EventDetailView.swift</files>
  <action>
Create EventDetailView as a popover/sheet showing full event details with action buttons:

```swift
import SwiftUI

struct EventDetailView: View {
    let event: Event
    @Environment(\.dismiss) private var dismiss

    private static let timeFormatter: DateFormatter = {
        let f = DateFormatter()
        f.dateStyle = .medium
        f.timeStyle = .short
        return f
    }()

    var body: some View {
        VStack(alignment: .leading, spacing: 16) {
            // Header
            HStack {
                Circle()
                    .fill(Color(cgColor: event.calendarColor))
                    .frame(width: 12, height: 12)

                Text(event.title)
                    .font(.headline)

                Spacer()

                Button(action: { dismiss() }) {
                    Image(systemName: "xmark.circle.fill")
                        .foregroundColor(.secondary)
                }
                .buttonStyle(.plain)
            }

            Divider()

            // Time
            HStack {
                Image(systemName: "clock")
                    .foregroundColor(.secondary)
                    .frame(width: 20)

                if event.isAllDay {
                    Text("All day")
                } else {
                    Text(Self.timeFormatter.string(from: event.startDate))
                }
            }

            // Location
            if let location = event.location, !location.isEmpty {
                HStack(alignment: .top) {
                    Image(systemName: "location")
                        .foregroundColor(.secondary)
                        .frame(width: 20)

                    Text(location)
                        .lineLimit(2)
                }
            }

            // Calendar
            HStack {
                Image(systemName: "calendar")
                    .foregroundColor(.secondary)
                    .frame(width: 20)

                Text(event.calendarTitle)
                    .foregroundColor(.secondary)
            }

            // Notes excerpt
            if let notes = event.notes, !notes.isEmpty {
                HStack(alignment: .top) {
                    Image(systemName: "note.text")
                        .foregroundColor(.secondary)
                        .frame(width: 20)

                    Text(notes.prefix(150) + (notes.count > 150 ? "..." : ""))
                        .font(.caption)
                        .foregroundColor(.secondary)
                        .lineLimit(3)
                }
            }

            Divider()

            // Action buttons
            HStack(spacing: 12) {
                if event.canJoinMeeting {
                    Button(action: { event.openMeetingURL() }) {
                        Label("Join", systemImage: "video")
                    }
                    .buttonStyle(.borderedProminent)
                }

                if event.canGetDirections {
                    Button(action: { event.openInMaps() }) {
                        Label("Directions", systemImage: "map")
                    }
                    .buttonStyle(.bordered)
                }

                Button(action: { event.copyToClipboard() }) {
                    Label("Copy", systemImage: "doc.on.doc")
                }
                .buttonStyle(.bordered)

                Spacer()
            }
        }
        .padding()
        .frame(width: 320)
    }
}
```

Add file to Xcode project in Views group.
  </action>
  <verify>Build succeeds with EventDetailView</verify>
  <done>EventDetailView shows event info with conditional Join/Directions/Copy buttons</done>
</task>

<task type="auto">
  <name>Task 3: Add quick action buttons to EventRowView</name>
  <files>ToEvent/ToEvent/Views/EventRowView.swift</files>
  <action>
Update EventRowView to show hover action buttons. When hovering, show Join (if available) and a menu button for more actions.

Replace the current rowContent with one that shows action buttons on hover:

1. Add state for showing detail popover:
```swift
@State private var showingDetail = false
```

2. Update rowContent to show action buttons on hover:
```swift
private var rowContent: some View {
    HStack(spacing: 8) {
        Circle()
            .fill(Color(cgColor: event.calendarColor))
            .frame(width: 8, height: 8)

        Text(truncatedTitle)
            .lineLimit(1)
            .foregroundStyle(.primary)

        Spacer()

        if isHovered {
            // Show action buttons on hover
            HStack(spacing: 4) {
                if event.canJoinMeeting {
                    Button(action: { event.openMeetingURL() }) {
                        Image(systemName: "video.fill")
                            .font(.caption)
                    }
                    .buttonStyle(.borderless)
                    .help("Join meeting")
                }

                Button(action: { showingDetail = true }) {
                    Image(systemName: "ellipsis.circle")
                        .font(.caption)
                }
                .buttonStyle(.borderless)
                .help("More actions")
            }
        } else {
            Text(timeDisplay)
                .foregroundStyle(.secondary)
        }
    }
    .popover(isPresented: $showingDetail) {
        EventDetailView(event: event)
    }
}
```

3. Keep the existing button style and hover logic.
  </action>
  <verify>Build succeeds; hover on event row shows Join button (if meeting URL) and ellipsis button</verify>
  <done>EventRowView shows action buttons on hover, opens EventDetailView on ellipsis tap</done>
</task>

</tasks>

<verification>
1. Build: `xcodebuild -project ToEvent/ToEvent.xcodeproj -scheme ToEvent build`
2. Event+Actions.swift exists in Extensions
3. EventDetailView.swift exists in Views
4. EventRowView shows action buttons on hover
5. Clicking Join opens meeting URL
6. Clicking ellipsis shows EventDetailView popover
</verification>

<success_criteria>
- Event extension has canJoinMeeting, canGetDirections computed properties
- Event extension has openMeetingURL(), openInMaps(), copyToClipboard() methods
- EventDetailView displays event info with conditional action buttons
- EventRowView shows Join button on hover when event has meeting URL
- EventRowView shows ellipsis button that opens EventDetailView popover
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/06-meeting-links-notifications/06-03-SUMMARY.md`
</output>
